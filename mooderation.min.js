function websocketConnect(){twitchWebsocket=new WebSocket("wss://irc-ws-r.chat.twitch.tv"),twitchWebsocket.onopen=(e=>{if(env.data.debug&&console.log(e),isConfigSet()||!env.data.debug){if(!isConfigSet()&&!oauthWarningSent)return alert("No OAuth Token Set! Please make sure to save it in your configuration!"),void(oauthWarningSent=!0);twitchWebsocket.send(`PASS oauth:${config.oauth}`),twitchWebsocket.send(`NICK ${config.username}`),twitchWebsocket.send("CAP REQ :twitch.tv/membership"),twitchWebsocket.send("CAP REQ :twitch.tv/tags"),twitchWebsocket.send("CAP REQ :twitch.tv/commands"),twitchWebsocket.send(`JOIN #${config.channel}`),twitchWebsocket.send(`PRIVMSG #${config.channel} :.mods`),isError=!1,clearInterval(interval),intervalTime=0,"Production"==env.data.environment||$.getJSON(`${env.data.twitchUsersUrl}/${config.channel}`,function(e){tempUserList=e})}else console.log("OAUTH not set")}),twitchWebsocket.onmessage=(e=>{if(env.data.debug&&console.log(e),e.data.includes("Login authentication failed")&&!oauthWarningSent)return alert("Invalid OAuth Token! Please refresh it in your configuration!"),void(oauthWarningSent=!0);if(!isModerator&&!modWarningSent)return alert("You are not a Moderator of this Channel! Please make sure you're using this moderation Tool properly!"),void(modWarningSent=!0);var t=e.data.split(";"),a={};t.forEach(function(e){var t=e.split("=");a[t[0]]=t[1]});let s=JSON.stringify(a);var n=JSON.parse(s);if(env.data.debug&&console.log(n),void 0!==n["@msg-id"]&&n["@msg-id"].includes(":The moderators of this channel are:")&&(moderatorUserNames=n["@msg-id"].replace(/^.*The moderators of this channel are: (.*)\r\n$/gimu,"$1").split(", "),isModerator=moderatorUserNames.includes(config.username)||config.channel==config.username,env.data.debug&&console.log(`isModerator: ${isModerator}`)),e.data.includes(`JOIN #${config.channel}`)){let t=e.data.replace(/^:([^!]*).*$/gimu,"$1");raidlist.list.forEach(function(e){e.userName==t&&new Notification(`Raid user ${e.userName} joined channel!`,{body:`${e.userName} | ${e.displayName} (${e.userId})`,vibrate:[200,100,200]})})}if(void 0!==n["user-id"]){var r=n["user-type"].replace(/^.*PRIVMSG[^:]*:(.*)\r\n$/gimu,"$1"),o=!1;r.includes("tmi.twitch.tv WHISPER")?r=n["user-type"].replace(/^.*@[^:]*:(.*)$/gimu,"WHISPERS: $1"):(badwords.list.forEach(function(e){var t=new RegExp(e,"gmiu");null!=r.match(t)&&("Notification"in window&&(new Notification("Bad word found!",{body:n["display-name"]+":"+e,vibrate:[200,100,200]}),notificationAudio.play()),env.data.debug&&console.log("Found bad word: "+e),o=!0)}),badusers.list.forEach(function(e){if(n["user-id"]==e.userid){if("Notification"in window){let t="";e.warnings.forEach(function(e){t+=`\n${e.type}: ${e.reason}`}),new Notification("Bad user found!",{body:`${e.username} (${e.userid})${t}`,vibrate:[200,100,200]}),notificationAudio.play()}env.data.debug&&console.log("Found bad user: "+e),o=!0}}));let e=void 0!==n["tmi-sent-ts"]?Number(n["tmi-sent-ts"]):Date.now(),t=void 0!==n.mod&&"1"==n.mod,a=void 0!==n.subscriber&&"1"==n.subscriber,s=!(void 0===n.badges||!n.badges.includes("vip")),l=streamerdblist.list.find(({streamerTwitchId:e})=>Number(e)==Number(n["user-id"])),c=void 0!==l;c&&!tempStreamerAppearedList.includes(n["user-id"])&&129043031!=n["user-id"]&&587687323!=n["user-id"]&&40164087!=n["user-id"]&&(new Notification("Streamer is posting!",{body:"Some streamer is posting something - attention!",vibrate:[200,100,200]}),notificationAudio.play(),tempStreamerAppearedList.push(n["user-id"]));let d=!1;var i={id:n.id,deleted:!1,warning:o,timestamp:e,userDisplayName:n["display-name"].toLowerCase(),userLogin:"",userId:Number(n["user-id"]),isSystem:!1,isModerator:t,isRaidListUser:d,isSubscriber:a,isStreamer:c,isVIP:s,message:r,occurances:0};if(void 0!==n["msg-id"]&&"subgift"==n["msg-id"]){let e=Number(n["user-id"]),t=n.login,a=parseInt(n["msg-param-gift-months"]),s=n["msg-param-recipient-user-name"],r=Number(n["msg-param-recipient-id"]),o=parseInt(n["msg-param-sub-plan"])/1e3;i.isSystem=!0,i.userId=e,i.userLogin=t,i.message=`${t} subgifted a Tier ${o} for ${a} month(s) to ${s} (${r})`}else if(void 0!==n["msg-id"]&&"resub"==n["msg-id"]){let e=Number(n["user-id"]),t=n.login,a=0==parseInt(n["msg-param-months"])?1:parseInt(n["msg-param-months"]),s=parseInt(n["msg-param-cumulative-months"]),r=parseInt(n["msg-param-sub-plan"])/1e3;i.isSystem=!0,i.userId=e,i.userLogin=t,i.message=`resubbed a Tier ${r} for ${a} month(s) overall ${s}`}else if(void 0!==n.bits&&""!=n.bits){let e=Number(n["user-id"]),t=n["display-name"],a=parseInt(n.bits),s=n["user-type"].replace(/^.*PRIVMSG[^:]*:\w*\d* (.*)\\r\\n$/gimu,"$1");i.isSystem=!0,i.userId=e,i.userDisplayName=t,i.message=`${t} cheered ${a} bits: ${s}`}i.occurances=countOccurrences(Array.from(chatlog.list,e=>e.userId+e.message),i.userId+i.message),chatlog.list.find(({id:e})=>e===n.id)||($("#chatwindow").append(chatMessageHtml(i)),chatlog.list.push(i),localStorage.setItem("chattext",JSON.stringify(chatlog))),$(window).trigger("chatscroll")}else parseReturnMessage(n)}),twitchWebsocket.onerror=function(e){isError=!0,env.data.debug&&console.log(`Websocket error: ${e}`)},twitchWebsocket.onclose=(e=>{isError||(env.data.debug&&console.log("Socket is closed.",e.reason),env.data.debug&&console.log(`Interval to next connection is ${intervalTime/1e3} seconds`),intervalTime=500,clearInterval(interval),interval=setInterval(function(){websocketConnect()},intervalTime*=2))})}const dataVersion=6,client_id="5dsbemnclyj3cigfl2wsgxnnmcevuu";var tempStreamerAppearedList=[],tempUserList={},tempUserDetail={},isModerator=!0,moderatorUserNames="",chatlog=null==localStorage.getItem("chattext")?{list:[]}:JSON.parse(localStorage.getItem("chattext")),bannedusers=null==localStorage.getItem("bannedusers")?{list:[]}:JSON.parse(localStorage.getItem("bannedusers")),config=null==localStorage.getItem("config")?{}:JSON.parse(localStorage.getItem("config")),badwords=null==localStorage.getItem("badwords")?{list:[]}:JSON.parse(localStorage.getItem("badwords")),badusers=null==localStorage.getItem("badusers")?{list:[]}:JSON.parse(localStorage.getItem("badusers")),env={data:{debug:!1}},raidlist={list:[]},streamerdblist={list:[]},excludemodwhisper={list:[]},languagecountries={list:[]};const countOccurrences=(e,t)=>e.reduce((e,a)=>a===t?e+1:e,0),twitchApiXhr=(e,t)=>(e.open("GET",t),e.responseType="json",e.setRequestHeader("Accept","*/*"),e.setRequestHeader("Authorization",`Bearer ${config.oauth}`),e.setRequestHeader("Client-ID",client_id),e),filterChatItems=(e,t)=>e.filter(e=>e.message.toLowerCase().indexOf(t.toLowerCase())>-1||e.userDisplayName.toLowerCase().indexOf(t.toLowerCase())>-1),filterItems=(e,t)=>e.filter(e=>e.toLowerCase().indexOf(t.toLowerCase())>-1),chatMessageHtml=e=>{var t=e.warning?" warn":"",a=e.isRaidListUser?" raiduser":"",s=e.isStreamer?" streamer":"",n=e.isModerator?" isMod":"",r=e.isVIP?" isVIP":"",o=e.isSystem?" isSystem":"",i=e.isSubscriber?" isSubscriber":"",l="";e.occurances>0&&(l=`<span class="occurances">(${e.occurances})</span>`);var c=`<div class="message${t}${a}${s}${n}${r}${i}${o}">${new Date(e.timestamp).toLocaleString(defaultLocale,{timeZoneName:"short"})} | <a class="user" href="#" data-userid="${e.userId}">${e.userDisplayName}</a> (${e.userId}): ${e.message}${l}</div><br/>`;return e.deleted||(c=`<button class="delete" data-deleteid="${e.id}">Delete</button>${c}`),c},isConfigSet=()=>void 0!==config.channel&&void 0!==config.username&&void 0!==config.oauth&&void 0!==config.languagecountry,jsonToCsv=e=>{let t=[Object.keys(e)].concat(e);return t.map(e=>JSON.stringify(Object.values(e)).substring(1,JSON.stringify(Object.values(e)).length-1)).join("\n")},jsonArrayToCsv=e=>{var t="";return e.forEach(function(e,a){0==a&&(t+=JSON.stringify(Object.keys(e)).substring(1,JSON.stringify(Object.keys(e)).length-1)+"\n"),t+=JSON.stringify(Object.values(e)).substring(1,JSON.stringify(Object.values(e)).length-1)+"\n"}),t},parseReturnMessage=e=>{let t=/^([0-9]+)/gimu;if(void 0!==e.emote_only){let a=t.exec(e.emote_only)[1];null!=a&&1==a&&"off"!=$("#emotemode").attr("data-current")?($("#emotemode").trigger("click",[!1]),new Notification("Emote only on",{body:"Some other mod activated Emote mode only!",vibrate:[200,100,200]}),notificationAudio.play()):null!=a&&0==a&&"on"!=$("#emotemode").attr("data-current")&&($("#emotemode").trigger("click",[!1]),new Notification("Emote only off",{body:"Some other mod deactivated Emote mode only!",vibrate:[200,100,200]}),notificationAudio.play())}if(void 0!==e.slow){let a=t.exec(e.slow)[1];null!=a&&a>0&&"off"!=$("#slowmode").attr("data-current")?($("#slowmode").trigger("click",[!1]),new Notification("Slowmode activated",{body:`Some other mod activated Slowmode ${a} seconds !`,vibrate:[200,100,200]}),notificationAudio.play()):null!=a&&0==a&&"on"!=$("#slowmode").attr("data-current")&&($("#slowmode").trigger("click",[!1]),new Notification("Slowmode deactivated",{body:`Some other mod deactivated Slowmode ${a} seconds !`,vibrate:[200,100,200]}),notificationAudio.play())}else if(void 0!==e["@followers-only"]){t=/^([-]?[0-9]+)/gimu;let a=t.exec(e["@followers-only"])[1];null!=a&&a>=0&&"off"!=$("#followersmode").attr("data-current")?($("#followersmode").trigger("click",[!1]),new Notification("Followers only on",{body:`Some other mod activated Followers only ${a} minutes !`,vibrate:[200,100,200]}),notificationAudio.play()):null!=a&&-1==a&&"on"!=$("#followersmode").attr("data-current")&&($("#followersmode").trigger("click",[!1]),new Notification("Followers only off",{body:"Some other mod deactivated Followers only!",vibrate:[200,100,200]}),notificationAudio.play())}else if(void 0!==e["subs-only"]){let a=t.exec(e["subs-only"])[1];null!=a&&1==a&&"off"!=$("#subscribersmode").attr("data-current")?($("#subscribersmode").trigger("click",[!1]),new Notification("Subscribers only on",{body:"Some other mod activated Subscriber mode only!",vibrate:[200,100,200]}),notificationAudio.play()):null!=a&&0==a&&"on"!=$("#subscribersmode").attr("data-current")&&($("#subscribersmode").trigger("click",[!1]),new Notification("Subscribers only off",{body:"Some other mod deactivated Subscriber mode only!",vibrate:[200,100,200]}),notificationAudio.play())}else if(void 0!==e["@r9k"]){let a=t.exec(e["@r9k"])[1];null!=a&&1==a&&"off"!=$("#r9kbetamode").attr("data-current")?($("#r9kbetamode").trigger("click",[!1]),new Notification("Uniquemode on",{body:"Some other mod activated Uniquemode (r9kbeta)!",vibrate:[200,100,200]}),notificationAudio.play()):null!=a&&0==a&&"on"!=$("#r9kbetamode").attr("data-current")&&($("#r9kbetamode").trigger("click",[!1]),new Notification("Uniquemode off",{body:"Some other mod deactivated Uniquemode (r9kbeta)!",vibrate:[200,100,200]}),notificationAudio.play())}else if(void 0!==e["@ban-duration"]){var a=new XMLHttpRequest;a=twitchApiXhr(a,`https://api.twitch.tv/helix/users?id=${e["target-user-id"]}`),a.send(),a.onload=(()=>{let t=a.response.data[0].display_name;new Notification("Uniquemode on",{body:`Some other mod timed out User: ${t} (${e["target-user-id"]}) for ${e["@ban-duration"]} seconds`,vibrate:[200,100,200]}),notificationAudio.play()})}},notificationAudio=new Audio("audio/notification.mp3");$(function(){document.getElementById("chatwindow").scrollIntoView({behavior:"smooth",block:"end",inline:"nearest"})});var defaultLocale="en-US";isConfigSet()&&(defaultLocale=config.languagecountry);var defaultStreamer="kaarujp";isConfigSet()&&(defaultStreamer=config.channel),$(function(){var e=["kaarujp","nicocoyukari"];e.forEach(function(e){var t="";isConfigSet()&&defaultStreamer==e&&(t=" selected"),$("#channel").append(`<option value="${e}"${t}>${e}</option>`)})}),void 0===chatlog.version||chatlog.version<dataVersion?(chatlog={version:dataVersion,list:[]},localStorage.setItem("chattext",JSON.stringify(chatlog))):chatlog.list.forEach(function(e){$("#chatwindow").append(chatMessageHtml(e))});var twitchWebsocket,twitchPubSubWebsocket,envJsonSource="env.json",envJsonRequest=$.getJSON(envJsonSource,function(e){env={version:dataVersion,data:e},"Production"==env.data.environment&&($("#userlistbutton").hide(),$("#raidirl").hide(),$("#modmessage").hide());var t={width:400,height:300,channel:defaultStreamer,parent:env.data.allowedSites},a=new Twitch.Player("videoPlayer",t);a.setVolume(.5);var s=`${env.data.raidListUrl}`;$.getJSON(s,function(e){raidlist={version:dataVersion,list:e}});var n=`${env.data.streamerListUrl}`;$.getJSON(n,function(e){streamerdblist={version:dataVersion,list:e}});var r=`${env.data.languageCountryUrl}`;$.getJSON(r,function(e){languagecountries={version:dataVersion,list:e},languagecountries.list.forEach(function(e){var t="";isConfigSet()&&config.languagecountry==e.languageTag&&(t=" selected"),$("#languagecountry").append(`<option value="${e.languageTag}"${t}>${e.languageName}(${e.languageTag})</option>`)})})}),excludemodwhisperJsonSource="exclude_mods_whisper.json";$.getJSON(excludemodwhisperJsonSource,function(e){e.push(config.username),excludemodwhisper={version:dataVersion,list:e}}),Notification.requestPermission().then(function(e){env.data.debug&&console.log(e)}),$("#configarea").hide();var interval,intervalTime=0,isError=!1,oauthWarningSent=!1,modWarningSent=!1;if(websocketConnect(),isConfigSet()&&($("#channel").val(config.channel),$("#username").val(config.username),$("#oauth").val(config.oauth)),document.location.hash){var parsedHash=new URLSearchParams(window.location.hash.substr(1));if(parsedHash.get("access_token")){var access_token=parsedHash.get("access_token");$("#oauth").val(access_token),env.data.debug&&console.log(access_token)}}$("#badwordListUpload").on("change",function(e){var t=new FileReader;t.onload=function(e){let t=JSON.parse(e.target.result);void 0!==t&&t.length>0&&(badwords={list:t})},t.readAsText(e.target.files[0])}),$("#savebadwords").on("click",function(e){localStorage.setItem("badwords",JSON.stringify(badwords))}),$("#baduserListUpload").on("change",function(e){var t=new FileReader;t.onload=function(e){let t=JSON.parse(e.target.result);void 0!==t&&t.length>0&&(badusers={list:t})},t.readAsText(e.target.files[0])}),$("#savebadusers").on("click",function(e){localStorage.setItem("badusers",JSON.stringify(badusers))}),$("#toggleconfig").on("click",function(e){$("#configarea").toggle("slow")}),$("#search").on("input",function(){let e=filterChatItems(chatlog.list,$(this).val());$("#chatwindow").html(""),e.forEach(function(e){$("#chatwindow").append(chatMessageHtml(e))})}),$("#filterusers").on("input",function(){$("#userlist p").html("");var e=0;if(tempUserList.chatters.admins.length>0){let t=filterItems(tempUserList.chatters.admins,$(this).val());t.length>0&&$("#userlist p").append("<strong>Admins</strong><br/>"),t.forEach(function(t){$("#userlist p").append(`<a href="#" class="user" data-username="${t}">${t}</a><br/>`),++e}),t.length>0&&$("#userlist p").append("<br/>")}if(tempUserList.chatters.broadcaster.length>0){let t=filterItems(tempUserList.chatters.broadcaster,$(this).val());t.length>0&&$("#userlist p").append("<strong>Broadcaster</strong><br/>"),t.forEach(function(t){$("#userlist p").append(`<a href="#" class="user" data-username="${t}">${t}</a><br/>`),++e}),t.length>0&&$("#userlist p").append("<br/>")}if(tempUserList.chatters.global_mods.length>0){let t=filterItems(tempUserList.chatters.global_mods,$(this).val());t.length>0&&$("#userlist p").append("<strong>Global Mods</strong><br/>"),t.forEach(function(t){$("#userlist p").append(`<a href="#" class="user" data-username="${t}">${t}</a><br/>`),++e}),t.length>0&&$("#userlist p").append("<br/>")}if(tempUserList.chatters.moderators.length>0){let t=filterItems(tempUserList.chatters.moderators,$(this).val());t.length>0&&$("#userlist p").append("<strong>Mods</strong><br/>"),t.forEach(function(t){$("#userlist p").append(`<a href="#" class="user" data-username="${t}">${t}</a><br/>`),++e}),t.length>0&&$("#userlist p").append("<br/>")}if(tempUserList.chatters.staff.length>0){let t=filterItems(tempUserList.chatters.staff,$(this).val());t.length>0&&$("#userlist p").append("<strong>Staff</strong><br/>"),t.forEach(function(t){$("#userlist p").append(`<a href="#" class="user" data-username="${t}">${t}</a><br/>`),++e}),t.length>0&&$("#userlist p").append("<br/>")}if(tempUserList.chatters.vips.length>0){let t=filterItems(tempUserList.chatters.vips,$(this).val());t.length>0&&$("#userlist p").append("<strong>VIPs</strong><br/>"),t.forEach(function(t){$("#userlist p").append(`<a href="#" class="user" data-username="${t}">${t}</a><br/>`),++e}),t.length>0&&$("#userlist p").append("<br/>")}if(tempUserList.chatters.viewers.length>0){let t=filterItems(tempUserList.chatters.viewers,$(this).val());t.length>0&&$("#userlist p").append('<strong>Viewers</strong><br/>new users <input id="newviewers" type="checkbox" value=""/><br/>'),t.forEach(function(t){$("#userlist p").append(`<a href="#" class="user" data-username="${t}">${t}</a><br/>`),++e}),t.length>0&&$("#userlist p").append("<br/>")}$("#userlist h2").text(`Users: ${e}`)}),$("#chatwindow").on("click","button.delete",function(e){var t=chatlog.list.findIndex(({id:e})=>e===$(this).attr("data-deleteid"));chatlog.list[t].deleted=!0,chatlog={version:dataVersion,list:chatlog.list},localStorage.setItem("chattext",JSON.stringify(chatlog)),twitchWebsocket.send("PRIVMSG #"+config.channel+" :.delete "+$(this).attr("data-deleteid")),this.style.display="none"}),$("button.command").on("click",function(e,t=!0){var[a,s]=["off"," active"];if("off"==$(this).attr("data-current")&&(a="on",s=""),$(this).text($(this).text().replace(/^([^(]*).*$/gimu,"$1 ("+a+")")),t){let e=$(this).attr("data-"+a);twitchWebsocket.send(`PRIVMSG #${config.channel} :.${e}`)}$(this).attr("class","command"+s),$(this).attr("data-current",a)}),$("#gettoken").on("click",function(e){window.location.href=`https://id.twitch.tv/oauth2/authorize?client_id=${client_id}&redirect_uri=${encodeURIComponent(env.data.redirect)}&response_type=token&scope=channel:read:redemptions+channel_editor+channel:moderate+chat:edit+chat:read+whispers:read+whispers:edit`}),$("#saveconfig").on("click",function(e){config={channel:$("#channel").val(),username:$("#username").val(),oauth:$("#oauth").val(),languagecountry:$("#languagecountry").attr("selected",!0).val()},localStorage.setItem("config",JSON.stringify(config)),location.reload()}),$(".reset").on("click",function(e){localStorage.removeItem($(this).attr("data-reset")),location.reload()}),$("#exportconfig").on("click",function(e){var t=jsonToCsv(config);$(this).attr("href",URL.createObjectURL(new Blob([t],{type:"text/csv"})))}),$("#exportchatlog, #exportbannedusers").on("click",function(e){var t=jsonArrayToCsv(chatlog.list);"exportbannedusers"==$(e.currentTarget).attr("id")&&(t=jsonArrayToCsv(bannedusers.list)),$(this).attr("href",URL.createObjectURL(new Blob([t],{type:"text/csv"})))}),$(window).on("chatscroll",function(e){window.innerHeight+window.pageYOffset>=document.body.offsetHeight&&document.getElementById("chatwindow").scrollIntoView({behavior:"smooth",block:"end",inline:"nearest"})}),$("#chatmessage").on("keypress",function(e){if("Enter"===e.key){let e=$(this).val();twitchWebsocket.send(`PRIVMSG #${config.channel} :${e}`);var t={id:0,deleted:!1,warning:!1,timestamp:Date.now(),userDisplayName:config.username.toLowerCase(),userName:"",isModerator:!0,isSubscriber:!0,isRaidListUser:!1,userId:0,message:e,occurances:0};chatlog.list.push(t),localStorage.setItem("chattext",JSON.stringify(chatlog)),$("#chatwindow").html($("#chatwindow").html()+chatMessageHtml(t)),$(window).trigger("chatscroll"),$(this).val("")}}),$("#modmessage").on("keypress",function(e){if("Enter"===e.key){if(!isModerator)return void alert("You are not a Moderator of this Channel! Please make sure you're using this moderation Tool properly!");let e=$(this).val();if(tempUserList.chatters.moderators.length>0){let a=tempUserList.chatters.moderators.filter(e=>!excludemodwhisper.list.includes(e));env.data.debug&&console.log(a),a.forEach(function(t){twitchWebsocket.send(`PRIVMSG #${config.channel} :.w ${t} (all mods) ${e}`)});var t={id:0,deleted:!1,warning:!1,timestamp:Date.now(),userDisplayName:config.username.toLowerCase(),userName:"",isModerator:!0,isSubscriber:!0,isRaidListUser:!1,userId:0,message:`WHISPERS: (all mods) ${e}`,occurances:0};chatlog.list.push(t),localStorage.setItem("chattext",JSON.stringify(chatlog)),$("#chatwindow").append(chatMessageHtml(t)),$(window).trigger("chatscroll"),$(this).val("")}}}),$("body").on("keypress","#userwhisper",function(e){if("Enter"===e.key){let e=$(this).val();var t=$(this).attr("data-username");twitchWebsocket.send(`PRIVMSG #${config.channel} :.w ${t} ${e}`),$(this).val("")}}),$("body").on("click",".user",function(e){e.preventDefault();var t=$(e.currentTarget).attr("data-userid"),a=$(e.currentTarget).attr("data-username");$("#useroverlay").fadeIn("slow"),$("#userpopup").fadeIn("slow",function(){var e=new XMLHttpRequest;void 0===t||0==t?(0==t&&(a=config.username),e=twitchApiXhr(e,`https://api.twitch.tv/helix/users?login=${a}`)):e=twitchApiXhr(e,`https://api.twitch.tv/helix/users?id=${t}`),e.send(),e.onload=(()=>{let s=e.response.data;a=s[0].login,t=s[0].id,$("#profile p",this).html(""),$("#profileactions",this).html(""),$("#profile h2",this).text(`User: ${s[0].display_name} (${a}|${t})`),""!=s[0].profile_image_url&&$("#profileimage",this).html(`<img src="${s[0].profile_image_url}" width="50" height="50" />`),""!=s[0].description&&$("#profile p",this).append(`Description: ${s[0].description}<br/>`),$("#profile p",this).append(`Views: ${s[0].view_count}<br/>`),""!=s[0].created_at&&$("#profile p",this).append(`Created at: ${new Date(s[0].created_at).toLocaleString(defaultLocale,{timeZoneName:"short"})}<br/>`),a!=config.username&&($("#profileactions",this).html(`<button id="shoutout" data-userid="${t}" data-username="${a}">Shoutout</button><button id="usertimeout" class="danger" data-userid="${t}" data-username="${a}">timeout</button><button id="userban" class="danger" data-userid="${t}" data-username="${a}">ban</button><button id="useruntimeout" data-userid="${t}" data-username="${a}">untimeout</button><button id="userunban" data-userid="${t}" data-username="${a}">unban</button>`),$("#profileactions",this).append(`<input id="userwhisper" type="text" placeholder="Send whisper to User ${a}" data-userid="${t}" data-username="${a}" />`)),tempUserDetail=s})})}),$("#raidirl").on("click",function(e){$.getJSON(`${env.data.getTestUrl}?streamerLoginName=${config.channel}`,function(e){let t=e.message;$("#chatmessage").val(t)})}),$("#userlistbutton").on("click",function(e){$("#userlistoverlay").fadeIn("slow"),$("#userlistpopup").fadeIn("slow",function(){$.getJSON(`${env.data.twitchUsersUrl}/${config.channel}`,function(e){let t=e;$("#userlist p").html(""),$("#userlist h2").text(`Users: ${t.chatter_count}`),t.chatters.admins.length>0&&($("#userlist p").append("<strong>Admins</strong><br/>"),t.chatters.admins.forEach(function(e){$("#userlist p").append(`<a href="#" class="user" data-username="${e}">${e}</a><br/>`)})),t.chatters.broadcaster.length>0&&($("#userlist p").append("<strong>Broadcaster</strong><br/>"),t.chatters.broadcaster.forEach(function(e){$("#userlist p").append(`<a href="#" class="user" data-username="${e}">${e}</a><br/>`)}),$("#userlist p").append("<br/>")),t.chatters.global_mods.length>0&&($("#userlist p").append("<strong>Global Mods</strong><br/>"),t.chatters.global_mods.forEach(function(e){$("#userlist p").append(`<a href="#" class="user" data-username="${e}">${e}</a><br/>`)}),$("#userlist p").append("<br/>")),t.chatters.moderators.length>0&&($("#userlist p").append("<strong>Mods</strong><br/>"),t.chatters.moderators.forEach(function(e){$("#userlist p").append(`<a href="#" class="user" data-username="${e}">${e}</a><br/>`)}),$("#userlist p").append("<br/>")),t.chatters.staff.length>0&&($("#userlist p").append("<strong>Staff</strong><br/>"),t.chatters.staff.forEach(function(e){$("#userlist p").append(`<a href="#" class="user" data-username="${e}">${e}</a><br/>`)}),$("#userlist p").append("<br/>")),t.chatters.vips.length>0&&($("#userlist p").append("<strong>VIPs</strong><br/>"),t.chatters.vips.forEach(function(e){$("#userlist p").append(`<a href="#" class="user" data-username="${e}">${e}</a><br/>`)}),$("#userlist p").append("<br/>")),t.chatters.viewers.length>0&&($("#userlist p").append('<strong>Viewers</strong><br/><span>new users <input id="newviewers" type="checkbox" value=""/></span><br/><span id="viewerslist">'),t.chatters.viewers.forEach(function(e){$("#viewerslist").append(`<a href="#" class="user" data-username="${e}">${e}</a><br/>`)}),$("#userlist p").append("<br/></span>")),env.data.debug&&console.log(e),tempUserList=t})})}),$("#userlist p").on("click","input#newviewers",function(e){var t="";$("#viewerslist").html(""),tempUserList.chatters.viewers.forEach(function(e){t+=`login=${e}&`});var a=new XMLHttpRequest;a=twitchApiXhr(a,`https://api.twitch.tv/helix/users?${t}`),a.send(),a.onload=(()=>{a.response.data.forEach(function(e){let t=e.login,a=e.created_at,s=new Date;new Date(a).getTime()>new Date(s.setDate(s.getDate()-10)).getTime()&&$("#viewerslist").append(`<a href="#" class="user" data-username="${t}">${t}</a><br/>`)})})}),$("#banfilteredusers, #timeoutfilteredusers").on("click",function(e){const t="banfilteredusers"==$(e.target).attr("id")?"Do you really want to BAN ALL those shown viewers?":"Do you really want to TIMEOUT ALL those shown viewers?";if(window.confirm(t)){let t=filterItems(tempUserList.chatters.viewers,$("#filterusers").val());t.length>0&&t.forEach(function(t){env.data.debug&&console.log(t),"banfilteredusers"==$(e.target).attr("id")?(bannedusers.list=bannedusers.list.filter(e=>e.username!==t).concat([{username:t}]),env.data.debug&&console.log(bannedusers),localStorage.setItem("bannedusers",JSON.stringify(bannedusers)),twitchWebsocket.send(`PRIVMSG #${config.channel} :.ban ${t}`)):twitchWebsocket.send(`PRIVMSG #${config.channel} :.timeout ${t}`)})}}),$("#userlistclose, #userlistoverlay").on("click",function(e){$("#userlistoverlay, #userlistpopup").fadeOut("slow")}),$("#userclose, #useroverlay").on("click",function(e){$("#useroverlay, #userpopup").fadeOut("slow")}),$("#clearcommand").on("click",function(e){twitchWebsocket.send(`PRIVMSG #${config.channel} :.clear`)}),$("#userpopup").on("click","#usertimeout",function(e){var t=$(this).attr("data-username");twitchWebsocket.send(`PRIVMSG #${config.channel} :.timeout ${t}`)}),$("#userpopup").on("click","#userban",function(e){var t=$(this).attr("data-username");twitchWebsocket.send(`PRIVMSG #${config.channel} :.ban ${t}`),bannedusers.list=bannedusers.list.filter(e=>e.username!==t).concat([{username:t}]),env.data.debug&&console.log(bannedusers),localStorage.setItem("bannedusers",JSON.stringify(bannedusers))}),$("#userpopup").on("click","#useruntimeout",function(e){var t=$(this).attr("data-username");twitchWebsocket.send(`PRIVMSG #${config.channel} :.untimeout ${t}`)}),$("#userpopup").on("click","#shoutout",function(e){var t=$(this).attr("data-username");twitchWebsocket.send(`PRIVMSG #${config.channel} :!so ${t}`)}),$("#userpopup").on("click","#userunban",function(e){var t=$(this).attr("data-username");twitchWebsocket.send(`PRIVMSG #${config.channel} :.unban ${t}`),bannedusers.list=bannedusers.list.filter(e=>e.username!==t),env.data.debug&&console.log(bannedusers),localStorage.setItem("bannedusers",JSON.stringify(bannedusers))}),$("#illaIRL").on("click",function(e){window.location.href="https://www.twitch.tv/illairl"}),$("#botdefense").on("click",function(e){twitchWebsocket.send(`PRIVMSG #${config.channel} :!botdefense full`)}),$("#videoPlayerToggle").on("click",function(e){$("#videoPlayer iframe").toggle()});